<!DOCTYPE html>
<html>
<head>
    <title>API Proxy</title>
</head>
<body>
    <script>
        async function handleRequest(request) {
            const url = new URL(request.url);
            const apiKey = url.searchParams.get('api_key');
            const anthropicApiUrl = 'https://api.anthropic.com/v1/messages';

            if (!apiKey) {
                return new Response('API key is required', { status: 400 });
            }

            const requestBody = await request.json();

            const proxyRequest = new Request(anthropicApiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-API-Key': apiKey,
                    'anthropic-version': '2023-06-01'
                },
                body: JSON.stringify(requestBody)
            });

            try {
                const response = await fetch(proxyRequest);
                const data = await response.json();
                return new Response(JSON.stringify(data), {
                    headers: { 'Content-Type': 'application/json' }
                });
            } catch (error) {
                return new Response(JSON.stringify({ error: error.message }), {
                    status: 500,
                    headers: { 'Content-Type': 'application/json' }
                });
            }
        }

        self.addEventListener('fetch', event => {
            event.respondWith(handleRequest(event.request));
        });
    </script>
    <p>caLL API test</p>
</body>
</html>
